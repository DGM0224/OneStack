<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main_layout}">
<head>
  <meta charset="UTF-8">
  <title>포트폴리오 수정</title>
  <link th:href="@{/css/editPortfolio.css}" rel="stylesheet">
</head>
<body>
<!-- ✅ 콘텐츠 영역 감싸기 -->
<div layout:fragment="content">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card shadow-lg border-0 rounded-3">
          <div class="card-body p-4">
            <h4 class="card-title text-center fw-bold mb-4">포트폴리오 수정</h4>
            <input type="hidden" id="portfolioNo" th:value="${portfolio.portfolioNo}">

            <form id="portfolioForm" enctype="multipart/form-data">
              <!-- ✅ 카테고리 선택 -->
              <label for="categoryNo">카테고리 *</label>
              <select id="categoryNo" name="categoryNo" class="form-select mb-3"
                      th:data-db-value="${professional.categoryNo}">
                <option value="1" th:selected="${professional.categoryNo == 1}">개발</option>
                <option value="2" th:selected="${professional.categoryNo == 2}">데이터</option>
              </select>

              <!-- ✅ 전문분야 선택 -->
              <label for="itemNo">전문분야 *</label>
              <select id="itemNo" name="itemNo" class="form-select mb-3"
                      th:data-db-value="${selectedItemNo}"
                      onchange="location.href='/editPortfolio?portfolioNo=' + document.getElementById('portfolioNo').value + '&itemNo=' + this.value">
                <option value="">전문분야 선택</option>
              </select>

              <!-- ✅ 설문조사 영역 -->
              <div id="surveyContainer" class="p-3 border rounded bg-light">
                <p class="text-muted" th:if="${surveyList == null or #lists.isEmpty(surveyList)}">
                  전문분야를 선택하면 해당하는 설문조사가 표시됩니다.
                </p>

                <th:block th:each="survey : ${surveyList}">
                  <div class="fw-bold my-2">
                    Q<span th:text="${survey.survey?.surveyNo}"></span>:
                    <span th:text="${survey.survey?.surveyQuestion}"></span>
                  </div>
                  <div>
                    <th:block th:each="option : ${#strings.arraySplit(survey.survey?.surveyOption, ',')}">
                      <div class="form-check">
                        <input class="form-check-input" type="radio"
                               th:name="'answer_' + ${survey.survey?.surveyNo}"
                               th:value="${option}" required>
                        <label class="form-check-label ms-2" th:text="${option}"></label>
                      </div>
                    </th:block>
                  </div>
                </th:block>
              </div>

              <!-- 자기소개 -->
              <label for="selfIntroduction">자기소개 *</label>
              <textarea class="form-control mb-2" id="selfIntroduction" name="selfIntroduction" required
                        th:text="${professional.selfIntroduction}"></textarea>

              <!-- 연락 가능 시간 -->
              <div class="mb-3">
                <label class="form-label">연락 가능 시간 *</label>
                <div class="d-flex gap-2">
                  <select class="form-select" id="contactableTimeStart" name="contactableTimeStart" required>
                    <option value="" hidden>시작 시간</option>
                    <option value="오전 9시" th:selected="${contactableTimeStart == '오전 9시'}">오전 9시</option>
                    <option value="오후 6시" th:selected="${contactableTimeStart == '오후 6시'}">오후 6시</option>
                  </select>
                  <span class="align-self-center">~</span>
                  <select class="form-select" id="contactableTimeEnd" name="contactableTimeEnd" required>
                    <option value="" hidden>종료 시간</option>
                    <option value="오전 9시" th:selected="${contactableTimeEnd == '오전 9시'}">오전 9시</option>
                    <option value="오후 6시" th:selected="${contactableTimeEnd == '오후 6시'}">오후 6시</option>
                  </select>
                </div>
              </div>

              <!-- 경력 -->
              <div class="form-field my-3">
                <div class="d-flex justify-content-between align-items-center">
                  <label>경력 *</label>
                  <button type="button" class="btn btn-outline-dark btn-sm add-career">추가</button>
                </div>
                <div id="careerContainer">
                  <th:block th:each="career : ${careerList}">
                    <div class="d-flex mb-2">
                      <input type="text" class="form-control" name="career" th:value="${career}">
                      <button type="button" class="btn btn-danger btn-sm remove-career">삭제</button>
                    </div>
                  </th:block>
                </div>
              </div>

              <!-- 포트폴리오 제목 -->
              <label for="portfolioTitle">포트폴리오 제목 *</label>
              <input type="text" class="form-control mb-2" id="portfolioTitle" name="portfolioTitle"
                     th:value="${portfolio.portfolioTitle}" required>

              <!-- 썸네일 이미지 -->
              <label for="thumbnailImage">썸네일 이미지 *</label>
              <input type="file" class="form-control mb-2" id="thumbnailImage" name="thumbnailImage" accept="image/*">
              <p class="text-muted">
                현재 파일: <span id="currentThumbnail" th:text="${portfolio.thumbnailImage}"></span>
                <button type="button" class="btn btn-danger btn-sm remove-thumbnail">삭제</button>
              </p>

              <!-- 포트폴리오 파일 -->
              <div id="portfolioFileContainer" class="mt-3" th:data-files-json="${portfolioFiles}"></div>
              <button type="button" class="btn btn-secondary btn-sm add-file-btn">파일 추가</button>

              <!-- 수정 완료 및 취소 버튼 -->
              <div class="text-end mt-4">
                <button type="button" class="btn btn-primary" id="updatePortfolioBtn">수정 완료</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn">취소</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<th:block layout:fragment="script">
  <script th:src="@{/js/editPortfolio.js}"></script>
</th:block>
</body>
</html>
